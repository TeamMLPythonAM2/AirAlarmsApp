import pandas as pd
import datetime as dt
import os

from app.config.configuration import Config


def prepare_merged_dataframe(
        weather_df: pd.DataFrame,
        telegram_df: pd.DataFrame,
        isw_df: pd.DataFrame,
        alarms_count: int
) -> pd.DataFrame:
    telegram_vectors = pd.concat([telegram_df[["telegram_vector"]]] * len(weather_df), ignore_index=True)
    isw_vectors = pd.concat([isw_df[["isw_vector"]]] * len(weather_df), ignore_index=True)

    merged_df = pd.concat([
        weather_df.reset_index(drop=True),
        telegram_vectors.reset_index(drop=True),
        isw_vectors.reset_index(drop=True),
        pd.Series(alarms_count, index=range(len(weather_df)), name='alarms_hourly')
    ], axis=1)

    return merged_df


def add_city_hour_score(dataframe):
    chvl_dict = {
        ('Cherkasy', 12): 0.9831261101243339,
        ('Cherkasy', 11): 0.9813499111900533,
        ('Cherkasy', 13): 0.9813499111900533,
        ('Cherkasy', 9): 0.9804618117229129,
        ('Cherkasy', 14): 0.9804618117229129,
        ('Cherkasy', 17): 0.9804618117229129,
        ('Cherkasy', 21): 0.9804618117229129,
        ('Cherkasy', 10): 0.9795737122557726,
        ('Cherkasy', 15): 0.9795737122557726,
        ('Cherkasy', 16): 0.9795737122557726,
        ('Cherkasy', 19): 0.9795737122557726,
        ('Cherkasy', 20): 0.9795737122557726,
        ('Cherkasy', 7): 0.9786856127886323,
        ('Cherkasy', 8): 0.9786856127886323,
        ('Cherkasy', 18): 0.9786856127886323,
        ('Cherkasy', 22): 0.977797513321492,
        ('Cherkasy', 23): 0.9760213143872114,
        ('Cherkasy', 0): 0.9529307282415631,
        ('Cherkasy', 6): 0.9404973357015985,
        ('Cherkasy', 1): 0.8561278863232682,
        ('Cherkasy', 5): 0.8428063943161634,
        ('Cherkasy', 2): 0.7761989342806395,
        ('Cherkasy', 4): 0.7477797513321492,
        ('Cherkasy', 3): 0.7060390763765542,
        ('Chernihiv', 13): 0.9849023090586145,
        ('Chernihiv', 11): 0.9822380106571936,
        ('Chernihiv', 12): 0.9822380106571936,
        ('Chernihiv', 14): 0.9822380106571936,
        ('Chernihiv', 21): 0.9813499111900533,
        ('Chernihiv', 9): 0.9804618117229129,
        ('Chernihiv', 10): 0.9804618117229129,
        ('Chernihiv', 15): 0.9804618117229129,
        ('Chernihiv', 18): 0.9804618117229129,
        ('Chernihiv', 16): 0.9795737122557726,
        ('Chernihiv', 19): 0.9795737122557726,
        ('Chernihiv', 7): 0.9786856127886323,
        ('Chernihiv', 8): 0.9786856127886323,
        ('Chernihiv', 17): 0.9786856127886323,
        ('Chernihiv', 20): 0.9786856127886323,
        ('Chernihiv', 22): 0.977797513321492,
        ('Chernihiv', 23): 0.9760213143872114,
        ('Chernihiv', 0): 0.955595026642984,
        ('Chernihiv', 6): 0.9404973357015985,
        ('Chernihiv', 1): 0.8561278863232682,
        ('Chernihiv', 5): 0.8428063943161634,
        ('Chernihiv', 2): 0.7761989342806395,
        ('Chernihiv', 4): 0.7468916518650088,
        ('Chernihiv', 3): 0.7060390763765542,
        ('Chernivtsi', 10): 0.9795737122557726,
        ('Chernivtsi', 20): 0.9795737122557726,
        ('Chernivtsi', 7): 0.9786856127886323,
        ('Chernivtsi', 8): 0.9786856127886323,
        ('Chernivtsi', 9): 0.9786856127886323,
        ('Chernivtsi', 11): 0.9786856127886323,
        ('Chernivtsi', 12): 0.9786856127886323,
        ('Chernivtsi', 13): 0.9786856127886323,
        ('Chernivtsi', 14): 0.9786856127886323,
        ('Chernivtsi', 15): 0.9786856127886323,
        ('Chernivtsi', 16): 0.9786856127886323,
        ('Chernivtsi', 17): 0.9786856127886323,
        ('Chernivtsi', 18): 0.9786856127886323,
        ('Chernivtsi', 19): 0.9786856127886323,
        ('Chernivtsi', 21): 0.977797513321492,
        ('Chernivtsi', 22): 0.9769094138543517,
        ('Chernivtsi', 23): 0.9751332149200711,
        ('Chernivtsi', 0): 0.9529307282415631,
        ('Chernivtsi', 6): 0.9404973357015985,
        ('Chernivtsi', 1): 0.8561278863232682,
        ('Chernivtsi', 5): 0.8428063943161634,
        ('Chernivtsi', 2): 0.7761989342806395,
        ('Chernivtsi', 4): 0.7468916518650088,
        ('Chernivtsi', 3): 0.7060390763765542,
        ('Dnipro', 13): 1.0,
        ('Dnipro', 12): 0.9928952042628775,
        ('Dnipro', 10): 0.9920071047957372,
        ('Dnipro', 14): 0.9884547069271759,
        ('Dnipro', 9): 0.9875666074600356,
        ('Dnipro', 17): 0.9866785079928952,
        ('Dnipro', 18): 0.9857904085257548,
        ('Dnipro', 19): 0.9857904085257548,
        ('Dnipro', 20): 0.9857904085257548,
        ('Dnipro', 11): 0.9849023090586145,
        ('Dnipro', 15): 0.9840142095914742,
        ('Dnipro', 16): 0.9831261101243339,
        ('Dnipro', 21): 0.9831261101243339,
        ('Dnipro', 7): 0.9822380106571936,
        ('Dnipro', 8): 0.9822380106571936,
        ('Dnipro', 22): 0.9822380106571936,
        ('Dnipro', 23): 0.977797513321492,
        ('Dnipro', 0): 0.9609236234458259,
        ('Dnipro', 6): 0.9422735346358793,
        ('Dnipro', 1): 0.8623445825932504,
        ('Dnipro', 5): 0.844582593250444,
        ('Dnipro', 2): 0.7779751332149201,
        ('Dnipro', 4): 0.7486678507992895,
        ('Dnipro', 3): 0.7060390763765542,
        ('Donetsk', 9): 0.9928952042628775,
        ('Donetsk', 8): 0.9911190053285968,
        ('Donetsk', 10): 0.9893428063943162,
        ('Donetsk', 12): 0.9893428063943162,
        ('Donetsk', 15): 0.9884547069271759,
        ('Donetsk', 13): 0.9875666074600356,
        ('Donetsk', 19): 0.9875666074600356,
        ('Donetsk', 11): 0.9866785079928952,
        ('Donetsk', 14): 0.9857904085257548,
        ('Donetsk', 20): 0.9857904085257548,
        ('Donetsk', 16): 0.9849023090586145,
        ('Donetsk', 18): 0.9849023090586145,
        ('Donetsk', 17): 0.9840142095914742,
        ('Donetsk', 7): 0.9831261101243339,
        ('Donetsk', 23): 0.9831261101243339,
        ('Donetsk', 21): 0.9813499111900533,
        ('Donetsk', 22): 0.9786856127886323,
        ('Donetsk', 0): 0.9582593250444049,
        ('Donetsk', 6): 0.9404973357015985,
        ('Donetsk', 1): 0.8614564831261101,
        ('Donetsk', 5): 0.8454706927175843,
        ('Donetsk', 2): 0.7788632326820604,
        ('Donetsk', 4): 0.7513321492007105,
        ('Donetsk', 3): 0.7078152753108348,
        ('Ivano-Frankivsk', 10): 0.9795737122557726,
        ('Ivano-Frankivsk', 16): 0.9795737122557726,
        ('Ivano-Frankivsk', 7): 0.9786856127886323,
        ('Ivano-Frankivsk', 8): 0.9786856127886323,
        ('Ivano-Frankivsk', 9): 0.9786856127886323,
        ('Ivano-Frankivsk', 11): 0.9786856127886323,
        ('Ivano-Frankivsk', 12): 0.9786856127886323,
        ('Ivano-Frankivsk', 13): 0.9786856127886323,
        ('Ivano-Frankivsk', 14): 0.9786856127886323,
        ('Ivano-Frankivsk', 15): 0.9786856127886323,
        ('Ivano-Frankivsk', 17): 0.9786856127886323,
        ('Ivano-Frankivsk', 18): 0.9786856127886323,
        ('Ivano-Frankivsk', 19): 0.9786856127886323,
        ('Ivano-Frankivsk', 20): 0.9786856127886323,
        ('Ivano-Frankivsk', 21): 0.977797513321492,
        ('Ivano-Frankivsk', 22): 0.9769094138543517,
        ('Ivano-Frankivsk', 23): 0.9751332149200711,
        ('Ivano-Frankivsk', 0): 0.9529307282415631,
        ('Ivano-Frankivsk', 6): 0.9404973357015985,
        ('Ivano-Frankivsk', 1): 0.8561278863232682,
        ('Ivano-Frankivsk', 5): 0.8428063943161634,
        ('Ivano-Frankivsk', 2): 0.7761989342806395,
        ('Ivano-Frankivsk', 4): 0.7468916518650088,
        ('Ivano-Frankivsk', 3): 0.7060390763765542,
        ('Kharkiv', 10): 0.9920071047957372,
        ('Kharkiv', 13): 0.9902309058614565,
        ('Kharkiv', 16): 0.9902309058614565,
        ('Kharkiv', 18): 0.9884547069271759,
        ('Kharkiv', 9): 0.9875666074600356,
        ('Kharkiv', 14): 0.9875666074600356,
        ('Kharkiv', 7): 0.9857904085257548,
        ('Kharkiv', 12): 0.9857904085257548,
        ('Kharkiv', 15): 0.9857904085257548,
        ('Kharkiv', 20): 0.9857904085257548,
        ('Kharkiv', 22): 0.9857904085257548,
        ('Kharkiv', 11): 0.9849023090586145,
        ('Kharkiv', 17): 0.9831261101243339,
        ('Kharkiv', 21): 0.9831261101243339,
        ('Kharkiv', 8): 0.9822380106571936,
        ('Kharkiv', 19): 0.9822380106571936,
        ('Kharkiv', 23): 0.9822380106571936,
        ('Kharkiv', 0): 0.9644760213143873,
        ('Kharkiv', 6): 0.9404973357015985,
        ('Kharkiv', 1): 0.8587921847246892,
        ('Kharkiv', 5): 0.8454706927175843,
        ('Kharkiv', 2): 0.7779751332149201,
        ('Kharkiv', 4): 0.7513321492007105,
        ('Kharkiv', 3): 0.7078152753108348,
        ('Kherson', 13): 0.9849023090586145,
        ('Kherson', 9): 0.9840142095914742,
        ('Kherson', 10): 0.9831261101243339,
        ('Kherson', 11): 0.9831261101243339,
        ('Kherson', 14): 0.9831261101243339,
        ('Kherson', 20): 0.9831261101243339,
        ('Kherson', 15): 0.9822380106571936,
        ('Kherson', 17): 0.9822380106571936,
        ('Kherson', 16): 0.9813499111900533,
        ('Kherson', 19): 0.9813499111900533,
        ('Kherson', 7): 0.9804618117229129,
        ('Kherson', 8): 0.9795737122557726,
        ('Kherson', 12): 0.9795737122557726,
        ('Kherson', 21): 0.9795737122557726,
        ('Kherson', 18): 0.9786856127886323,
        ('Kherson', 23): 0.9786856127886323,
        ('Kherson', 22): 0.9769094138543517,
        ('Kherson', 0): 0.9538188277087034,
        ('Kherson', 6): 0.9404973357015985,
        ('Kherson', 1): 0.8587921847246892,
        ('Kherson', 5): 0.844582593250444,
        ('Kherson', 2): 0.7770870337477798,
        ('Kherson', 4): 0.7477797513321492,
        ('Kherson', 3): 0.7069271758436945,
        ('Khmelnytskyi', 10): 0.9795737122557726,
        ('Khmelnytskyi', 16): 0.9795737122557726,
        ('Khmelnytskyi', 7): 0.9786856127886323,
        ('Khmelnytskyi', 8): 0.9786856127886323,
        ('Khmelnytskyi', 9): 0.9786856127886323,
        ('Khmelnytskyi', 11): 0.9786856127886323,
        ('Khmelnytskyi', 12): 0.9786856127886323,
        ('Khmelnytskyi', 13): 0.9786856127886323,
        ('Khmelnytskyi', 14): 0.9786856127886323,
        ('Khmelnytskyi', 15): 0.9786856127886323,
        ('Khmelnytskyi', 17): 0.9786856127886323,
        ('Khmelnytskyi', 18): 0.9786856127886323,
        ('Khmelnytskyi', 19): 0.9786856127886323,
        ('Khmelnytskyi', 20): 0.9786856127886323,
        ('Khmelnytskyi', 21): 0.977797513321492,
        ('Khmelnytskyi', 22): 0.9769094138543517,
        ('Khmelnytskyi', 23): 0.9751332149200711,
        ('Khmelnytskyi', 0): 0.9547069271758437,
        ('Khmelnytskyi', 6): 0.9404973357015985,
        ('Khmelnytskyi', 1): 0.8561278863232682,
        ('Khmelnytskyi', 5): 0.8428063943161634,
        ('Khmelnytskyi', 2): 0.7761989342806395,
        ('Khmelnytskyi', 4): 0.7477797513321492,
        ('Khmelnytskyi', 3): 0.7060390763765542,
        ('Kropyvnytskyi', 10): 0.9849023090586145,
        ('Kropyvnytskyi', 12): 0.9831261101243339,
        ('Kropyvnytskyi', 9): 0.9822380106571936,
        ('Kropyvnytskyi', 11): 0.9822380106571936,
        ('Kropyvnytskyi', 13): 0.9822380106571936,
        ('Kropyvnytskyi', 14): 0.9822380106571936,
        ('Kropyvnytskyi', 17): 0.9822380106571936,
        ('Kropyvnytskyi', 20): 0.9813499111900533,
        ('Kropyvnytskyi', 21): 0.9813499111900533,
        ('Kropyvnytskyi', 15): 0.9804618117229129,
        ('Kropyvnytskyi', 18): 0.9804618117229129,
        ('Kropyvnytskyi', 8): 0.9795737122557726,
        ('Kropyvnytskyi', 16): 0.9795737122557726,
        ('Kropyvnytskyi', 19): 0.9795737122557726,
        ('Kropyvnytskyi', 7): 0.9786856127886323,
        ('Kropyvnytskyi', 22): 0.9786856127886323,
        ('Kropyvnytskyi', 23): 0.977797513321492,
        ('Kropyvnytskyi', 0): 0.9538188277087034,
        ('Kropyvnytskyi', 6): 0.9404973357015985,
        ('Kropyvnytskyi', 1): 0.8579040852575488,
        ('Kropyvnytskyi', 5): 0.8428063943161634,
        ('Kropyvnytskyi', 2): 0.7761989342806395,
        ('Kropyvnytskyi', 4): 0.7477797513321492,
        ('Kropyvnytskyi', 3): 0.7060390763765542,
        ('Kyiv', 13): 0.9822380106571936,
        ('Kyiv', 12): 0.9813499111900533,
        ('Kyiv', 20): 0.9813499111900533,
        ('Kyiv', 18): 0.9804618117229129,
        ('Kyiv', 19): 0.9804618117229129,
        ('Kyiv', 10): 0.9795737122557726,
        ('Kyiv', 11): 0.9795737122557726,
        ('Kyiv', 14): 0.9795737122557726,
        ('Kyiv', 16): 0.9795737122557726,
        ('Kyiv', 17): 0.9795737122557726,
        ('Kyiv', 7): 0.9786856127886323,
        ('Kyiv', 8): 0.9786856127886323,
        ('Kyiv', 9): 0.9786856127886323,
        ('Kyiv', 15): 0.9786856127886323,
        ('Kyiv', 21): 0.977797513321492,
        ('Kyiv', 23): 0.977797513321492,
        ('Kyiv', 22): 0.9769094138543517,
        ('Kyiv', 0): 0.9547069271758437,
        ('Kyiv', 6): 0.9422735346358793,
        ('Kyiv', 1): 0.8561278863232682,
        ('Kyiv', 5): 0.8428063943161634,
        ('Kyiv', 2): 0.7770870337477798,
        ('Kyiv', 4): 0.7486678507992895,
        ('Kyiv', 3): 0.7069271758436945,
        ('Kyiv oblast', 13): 0.9822380106571936,
        ('Kyiv oblast', 11): 0.9804618117229129,
        ('Kyiv oblast', 10): 0.9795737122557726,
        ('Kyiv oblast', 15): 0.9795737122557726,
        ('Kyiv oblast', 16): 0.9795737122557726,
        ('Kyiv oblast', 20): 0.9795737122557726,
        ('Kyiv oblast', 7): 0.9786856127886323,
        ('Kyiv oblast', 8): 0.9786856127886323,
        ('Kyiv oblast', 9): 0.9786856127886323,
        ('Kyiv oblast', 12): 0.9786856127886323,
        ('Kyiv oblast', 14): 0.9786856127886323,
        ('Kyiv oblast', 17): 0.9786856127886323,
        ('Kyiv oblast', 18): 0.9786856127886323,
        ('Kyiv oblast', 19): 0.9786856127886323,
        ('Kyiv oblast', 21): 0.977797513321492,
        ('Kyiv oblast', 22): 0.977797513321492,
        ('Kyiv oblast', 23): 0.9769094138543517,
        ('Kyiv oblast', 0): 0.9547069271758437,
        ('Kyiv oblast', 6): 0.9404973357015985,
        ('Kyiv oblast', 1): 0.8570159857904085,
        ('Kyiv oblast', 5): 0.8436944937833037,
        ('Kyiv oblast', 2): 0.7761989342806395,
        ('Kyiv oblast', 4): 0.7477797513321492,
        ('Kyiv oblast', 3): 0.7060390763765542,
        ('Lutsk', 10): 0.9795737122557726,
        ('Lutsk', 11): 0.9795737122557726,
        ('Lutsk', 16): 0.9795737122557726,
        ('Lutsk', 17): 0.9795737122557726,
        ('Lutsk', 18): 0.9795737122557726,
        ('Lutsk', 7): 0.9786856127886323,
        ('Lutsk', 8): 0.9786856127886323,
        ('Lutsk', 9): 0.9786856127886323,
        ('Lutsk', 12): 0.9786856127886323,
        ('Lutsk', 13): 0.9786856127886323,
        ('Lutsk', 14): 0.9786856127886323,
        ('Lutsk', 15): 0.9786856127886323,
        ('Lutsk', 19): 0.9786856127886323,
        ('Lutsk', 20): 0.9786856127886323,
        ('Lutsk', 21): 0.977797513321492,
        ('Lutsk', 22): 0.9769094138543517,
        ('Lutsk', 23): 0.9760213143872114,
        ('Lutsk', 0): 0.9529307282415631,
        ('Lutsk', 6): 0.9413854351687388,
        ('Lutsk', 1): 0.8561278863232682,
        ('Lutsk', 5): 0.8428063943161634,
        ('Lutsk', 2): 0.7761989342806395,
        ('Lutsk', 4): 0.7477797513321492,
        ('Lutsk', 3): 0.7060390763765542,
        ('Lviv', 11): 0.9795737122557726,
        ('Lviv', 16): 0.9795737122557726,
        ('Lviv', 7): 0.9786856127886323,
        ('Lviv', 8): 0.9786856127886323,
        ('Lviv', 9): 0.9786856127886323,
        ('Lviv', 10): 0.9786856127886323,
        ('Lviv', 12): 0.9786856127886323,
        ('Lviv', 13): 0.9786856127886323,
        ('Lviv', 14): 0.9786856127886323,
        ('Lviv', 15): 0.9786856127886323,
        ('Lviv', 17): 0.9786856127886323,
        ('Lviv', 18): 0.9786856127886323,
        ('Lviv', 19): 0.9786856127886323,
        ('Lviv', 20): 0.9786856127886323,
        ('Lviv', 21): 0.977797513321492,
        ('Lviv', 22): 0.9769094138543517,
        ('Lviv', 23): 0.9751332149200711,
        ('Lviv', 0): 0.9529307282415631,
        ('Lviv', 6): 0.9404973357015985,
        ('Lviv', 1): 0.8561278863232682,
        ('Lviv', 5): 0.8428063943161634,
        ('Lviv', 2): 0.7761989342806395,
        ('Lviv', 4): 0.7468916518650088,
        ('Lviv', 3): 0.7060390763765542,
        ('Mykolaiv', 11): 0.9849023090586145,
        ('Mykolaiv', 9): 0.9840142095914742,
        ('Mykolaiv', 13): 0.9831261101243339,
        ('Mykolaiv', 14): 0.9831261101243339,
        ('Mykolaiv', 17): 0.9831261101243339,
        ('Mykolaiv', 10): 0.9822380106571936,
        ('Mykolaiv', 20): 0.9822380106571936,
        ('Mykolaiv', 19): 0.9813499111900533,
        ('Mykolaiv', 7): 0.9804618117229129,
        ('Mykolaiv', 15): 0.9804618117229129,
        ('Mykolaiv', 18): 0.9795737122557726,
        ('Mykolaiv', 8): 0.9786856127886323,
        ('Mykolaiv', 12): 0.9786856127886323,
        ('Mykolaiv', 16): 0.9786856127886323,
        ('Mykolaiv', 21): 0.977797513321492,
        ('Mykolaiv', 22): 0.977797513321492,
        ('Mykolaiv', 23): 0.977797513321492,
        ('Mykolaiv', 0): 0.955595026642984,
        ('Mykolaiv', 6): 0.9404973357015985,
        ('Mykolaiv', 1): 0.8596802841918295,
        ('Mykolaiv', 5): 0.8428063943161634,
        ('Mykolaiv', 2): 0.7761989342806395,
        ('Mykolaiv', 4): 0.7477797513321492,
        ('Mykolaiv', 3): 0.7060390763765542,
        ('Odesa', 10): 0.9813499111900533,
        ('Odesa', 19): 0.9813499111900533,
        ('Odesa', 20): 0.9813499111900533,
        ('Odesa', 7): 0.9804618117229129,
        ('Odesa', 11): 0.9804618117229129,
        ('Odesa', 12): 0.9804618117229129,
        ('Odesa', 8): 0.9795737122557726,
        ('Odesa', 9): 0.9795737122557726,
        ('Odesa', 13): 0.9795737122557726,
        ('Odesa', 14): 0.9795737122557726,
        ('Odesa', 15): 0.9795737122557726,
        ('Odesa', 17): 0.9795737122557726,
        ('Odesa', 18): 0.9795737122557726,
        ('Odesa', 21): 0.9795737122557726,
        ('Odesa', 16): 0.9786856127886323,
        ('Odesa', 23): 0.977797513321492,
        ('Odesa', 22): 0.9769094138543517,
        ('Odesa', 0): 0.9529307282415631,
        ('Odesa', 6): 0.9404973357015985,
        ('Odesa', 1): 0.8579040852575488,
        ('Odesa', 5): 0.8428063943161634,
        ('Odesa', 2): 0.7761989342806395,
        ('Odesa', 4): 0.7468916518650088,
        ('Odesa', 3): 0.7069271758436945,
        ('Poltava', 10): 0.9875666074600356,
        ('Poltava', 13): 0.9857904085257548,
        ('Poltava', 14): 0.9857904085257548,
        ('Poltava', 11): 0.9840142095914742,
        ('Poltava', 12): 0.9840142095914742,
        ('Poltava', 9): 0.9822380106571936,
        ('Poltava', 17): 0.9822380106571936,
        ('Poltava', 18): 0.9822380106571936,
        ('Poltava', 20): 0.9822380106571936,
        ('Poltava', 8): 0.9813499111900533,
        ('Poltava', 15): 0.9813499111900533,
        ('Poltava', 21): 0.9813499111900533,
        ('Poltava', 22): 0.9804618117229129,
        ('Poltava', 16): 0.9795737122557726,
        ('Poltava', 19): 0.9795737122557726,
        ('Poltava', 7): 0.9786856127886323,
        ('Poltava', 23): 0.9769094138543517,
        ('Poltava', 0): 0.955595026642984,
        ('Poltava', 6): 0.9422735346358793,
        ('Poltava', 1): 0.8596802841918295,
        ('Poltava', 5): 0.8436944937833037,
        ('Poltava', 2): 0.7788632326820604,
        ('Poltava', 4): 0.7477797513321492,
        ('Poltava', 3): 0.7069271758436945,
        ('Rivne', 10): 0.9795737122557726,
        ('Rivne', 11): 0.9795737122557726,
        ('Rivne', 16): 0.9795737122557726,
        ('Rivne', 7): 0.9786856127886323,
        ('Rivne', 8): 0.9786856127886323,
        ('Rivne', 9): 0.9786856127886323,
        ('Rivne', 12): 0.9786856127886323,
        ('Rivne', 13): 0.9786856127886323,
        ('Rivne', 14): 0.9786856127886323,
        ('Rivne', 15): 0.9786856127886323,
        ('Rivne', 17): 0.9786856127886323,
        ('Rivne', 18): 0.9786856127886323,
        ('Rivne', 19): 0.9786856127886323,
        ('Rivne', 20): 0.9786856127886323,
        ('Rivne', 21): 0.977797513321492,
        ('Rivne', 22): 0.9769094138543517,
        ('Rivne', 23): 0.9751332149200711,
        ('Rivne', 0): 0.9529307282415631,
        ('Rivne', 6): 0.9404973357015985,
        ('Rivne', 1): 0.8561278863232682,
        ('Rivne', 5): 0.8428063943161634,
        ('Rivne', 2): 0.7761989342806395,
        ('Rivne', 4): 0.7468916518650088,
        ('Rivne', 3): 0.7060390763765542,
        ('Sumy', 8): 0.9840142095914742,
        ('Sumy', 10): 0.9840142095914742,
        ('Sumy', 11): 0.9840142095914742,
        ('Sumy', 12): 0.9840142095914742,
        ('Sumy', 13): 0.9840142095914742,
        ('Sumy', 15): 0.9831261101243339,
        ('Sumy', 17): 0.9822380106571936,
        ('Sumy', 9): 0.9813499111900533,
        ('Sumy', 18): 0.9813499111900533,
        ('Sumy', 22): 0.9813499111900533,
        ('Sumy', 14): 0.9804618117229129,
        ('Sumy', 20): 0.9804618117229129,
        ('Sumy', 16): 0.9795737122557726,
        ('Sumy', 19): 0.9795737122557726,
        ('Sumy', 21): 0.9795737122557726,
        ('Sumy', 23): 0.9795737122557726,
        ('Sumy', 7): 0.9786856127886323,
        ('Sumy', 0): 0.9547069271758437,
        ('Sumy', 6): 0.9422735346358793,
        ('Sumy', 1): 0.8587921847246892,
        ('Sumy', 5): 0.844582593250444,
        ('Sumy', 2): 0.7779751332149201,
        ('Sumy', 4): 0.7477797513321492,
        ('Sumy', 3): 0.7060390763765542,
        ('Ternopil', 10): 0.9795737122557726,
        ('Ternopil', 16): 0.9795737122557726,
        ('Ternopil', 20): 0.9795737122557726,
        ('Ternopil', 7): 0.9786856127886323,
        ('Ternopil', 8): 0.9786856127886323,
        ('Ternopil', 9): 0.9786856127886323,
        ('Ternopil', 11): 0.9786856127886323,
        ('Ternopil', 12): 0.9786856127886323,
        ('Ternopil', 13): 0.9786856127886323,
        ('Ternopil', 14): 0.9786856127886323,
        ('Ternopil', 15): 0.9786856127886323,
        ('Ternopil', 17): 0.9786856127886323,
        ('Ternopil', 18): 0.9786856127886323,
        ('Ternopil', 19): 0.9786856127886323,
        ('Ternopil', 21): 0.977797513321492,
        ('Ternopil', 22): 0.9769094138543517,
        ('Ternopil', 23): 0.9751332149200711,
        ('Ternopil', 0): 0.9529307282415631,
        ('Ternopil', 6): 0.9404973357015985,
        ('Ternopil', 1): 0.8570159857904085,
        ('Ternopil', 5): 0.8428063943161634,
        ('Ternopil', 2): 0.7761989342806395,
        ('Ternopil', 4): 0.7468916518650088,
        ('Ternopil', 3): 0.7060390763765542,
        ('Uzhgorod', 10): 0.9795737122557726,
        ('Uzhgorod', 16): 0.9795737122557726,
        ('Uzhgorod', 7): 0.9786856127886323,
        ('Uzhgorod', 8): 0.9786856127886323,
        ('Uzhgorod', 9): 0.9786856127886323,
        ('Uzhgorod', 11): 0.9786856127886323,
        ('Uzhgorod', 12): 0.9786856127886323,
        ('Uzhgorod', 13): 0.9786856127886323,
        ('Uzhgorod', 14): 0.9786856127886323,
        ('Uzhgorod', 15): 0.9786856127886323,
        ('Uzhgorod', 17): 0.9786856127886323,
        ('Uzhgorod', 18): 0.9786856127886323,
        ('Uzhgorod', 19): 0.9786856127886323,
        ('Uzhgorod', 20): 0.9786856127886323,
        ('Uzhgorod', 21): 0.977797513321492,
        ('Uzhgorod', 22): 0.9769094138543517,
        ('Uzhgorod', 23): 0.9751332149200711,
        ('Uzhgorod', 0): 0.9529307282415631,
        ('Uzhgorod', 6): 0.9404973357015985,
        ('Uzhgorod', 1): 0.8561278863232682,
        ('Uzhgorod', 5): 0.8428063943161634,
        ('Uzhgorod', 2): 0.7761989342806395,
        ('Uzhgorod', 4): 0.7468916518650088,
        ('Uzhgorod', 3): 0.7060390763765542,
        ('Vinnytsia', 18): 0.9813499111900533,
        ('Vinnytsia', 9): 0.9804618117229129,
        ('Vinnytsia', 13): 0.9804618117229129,
        ('Vinnytsia', 16): 0.9804618117229129,
        ('Vinnytsia', 10): 0.9795737122557726,
        ('Vinnytsia', 12): 0.9795737122557726,
        ('Vinnytsia', 15): 0.9795737122557726,
        ('Vinnytsia', 17): 0.9795737122557726,
        ('Vinnytsia', 7): 0.9786856127886323,
        ('Vinnytsia', 8): 0.9786856127886323,
        ('Vinnytsia', 11): 0.9786856127886323,
        ('Vinnytsia', 14): 0.9786856127886323,
        ('Vinnytsia', 19): 0.9786856127886323,
        ('Vinnytsia', 20): 0.9786856127886323,
        ('Vinnytsia', 21): 0.977797513321492,
        ('Vinnytsia', 22): 0.9769094138543517,
        ('Vinnytsia', 23): 0.9751332149200711,
        ('Vinnytsia', 0): 0.9538188277087034,
        ('Vinnytsia', 6): 0.9404973357015985,
        ('Vinnytsia', 1): 0.8561278863232682,
        ('Vinnytsia', 5): 0.8428063943161634,
        ('Vinnytsia', 2): 0.7770870337477798,
        ('Vinnytsia', 4): 0.7468916518650088,
        ('Vinnytsia', 3): 0.7069271758436945,
        ('Zaporozhye', 10): 0.9937833037300178,
        ('Zaporozhye', 12): 0.9902309058614565,
        ('Zaporozhye', 13): 0.9893428063943162,
        ('Zaporozhye', 11): 0.9884547069271759,
        ('Zaporozhye', 14): 0.9884547069271759,
        ('Zaporozhye', 17): 0.9875666074600356,
        ('Zaporozhye', 15): 0.9857904085257548,
        ('Zaporozhye', 20): 0.9857904085257548,
        ('Zaporozhye', 9): 0.9849023090586145,
        ('Zaporozhye', 19): 0.9831261101243339,
        ('Zaporozhye', 7): 0.9822380106571936,
        ('Zaporozhye', 8): 0.9822380106571936,
        ('Zaporozhye', 16): 0.9822380106571936,
        ('Zaporozhye', 18): 0.9822380106571936,
        ('Zaporozhye', 21): 0.9813499111900533,
        ('Zaporozhye', 22): 0.9795737122557726,
        ('Zaporozhye', 23): 0.9795737122557726,
        ('Zaporozhye', 0): 0.9547069271758437,
        ('Zaporozhye', 6): 0.9422735346358793,
        ('Zaporozhye', 1): 0.8614564831261101,
        ('Zaporozhye', 5): 0.8454706927175843,
        ('Zaporozhye', 2): 0.7761989342806395,
        ('Zaporozhye', 4): 0.7486678507992895,
        ('Zaporozhye', 3): 0.7060390763765542,
        ('Zhytomyr', 13): 0.9840142095914742,
        ('Zhytomyr', 18): 0.9804618117229129,
        ('Zhytomyr', 7): 0.9795737122557726,
        ('Zhytomyr', 10): 0.9795737122557726,
        ('Zhytomyr', 15): 0.9795737122557726,
        ('Zhytomyr', 8): 0.9786856127886323,
        ('Zhytomyr', 9): 0.9786856127886323,
        ('Zhytomyr', 11): 0.9786856127886323,
        ('Zhytomyr', 12): 0.9786856127886323,
        ('Zhytomyr', 14): 0.9786856127886323,
        ('Zhytomyr', 16): 0.9786856127886323,
        ('Zhytomyr', 17): 0.9786856127886323,
        ('Zhytomyr', 19): 0.9786856127886323,
        ('Zhytomyr', 20): 0.9786856127886323,
        ('Zhytomyr', 21): 0.977797513321492,
        ('Zhytomyr', 22): 0.9769094138543517,
        ('Zhytomyr', 23): 0.9751332149200711,
        ('Zhytomyr', 0): 0.955595026642984,
        ('Zhytomyr', 6): 0.9404973357015985,
        ('Zhytomyr', 1): 0.8561278863232682,
        ('Zhytomyr', 5): 0.8428063943161634,
        ('Zhytomyr', 2): 0.7761989342806395,
        ('Zhytomyr', 4): 0.7468916518650088,
        ('Zhytomyr', 3): 0.7060390763765542
    }

    def get_city_hour_score(row):
        key = (row['city_address'], row['day_hour'])
        return chvl_dict.get(key, 0)

    dataframe['alarm_chance_day_hour'] = dataframe.apply(get_city_hour_score, axis=1)
    return dataframe


def add_holiday_koef(dataframe):
    ru_holidays_d = {
        '01-01': 1,
        '01-02': 1,
        '01-03': 1,
        '01-04': 1,
        '01-05': 1,
        '01-06': 1,
        '01-08': 1,
        '01-07': 1,
        '02-23': 5,
        '03-08': 1,
        '05-01': 1,
        '05-09': 5,
        '06-12': 5,
        '11-04': 1
    }
    ua_holidays = {
        '01-01': 2,
        '04-28': 1,
        '08-24': 5,
        '03-08': 1,
        '10-14': 3,
    }

    def get_holiday_koef(dtt):
        return ru_holidays_d.get(dtt.strftime('%m-%d')) or ua_holidays.get(dtt.strftime('%m-%d')) or 0

    dataframe["is_holiday_and_koef"] = dataframe["datetime"].apply(lambda x: get_holiday_koef(x))
    return dataframe


def expand_vectors(df: pd.DataFrame) -> pd.DataFrame:
    vector_isw = df['isw_vector'].apply(pd.Series)
    vector_isw.columns = [f'isw_{i}' for i in range(vector_isw.shape[1])]
    df = pd.concat([df.drop(columns=['isw_vector']), vector_isw], axis=1)

    vector_tg = df['telegram_vector'].apply(pd.Series)
    vector_tg.columns = [f'telegram_{i}' for i in range(vector_tg.shape[1])]
    df = pd.concat([df.drop(columns=['telegram_vector']), vector_tg], axis=1)

    return df


def save_data(data: pd.DataFrame, date: dt.datetime) -> None:
    df = data.drop_duplicates(subset="city_address").copy()
    df['datetime'] = date
    df['day_hour'] = date.hour

    path = os.path.join(Config.DATASETS_PATH, f'{date.strftime('%Y-%m-%d_%H')}.parquet')
    df.to_parquet(path, index=False)
